<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>BuildSync Prototype – Bid Builder</title>
    <style>
        :root {
            --bg: #f4f6f8;
            --card-bg: #ffffff;
            --text: #334e68;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg: #1e1e1e;
            --card-bg: #2a2a2a;
            --text: #e0e0e0;
            --shadow: rgba(0, 0, 0, 0.5);
        }

        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            transition: background 0.3s, color 0.3s;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--text);
            color: #fff;
            padding: 1rem;
        }

        header h1 {
            margin: 0;
            font-size: 1.2rem;
        }

        nav a {
            color: #fff;
            text-decoration: none;
            margin-left: 1rem;
            font-size: 0.9rem;
        }

        .mode-toggle {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            margin-left: 1rem;
        }

        .container {
            padding: 1rem;
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .controls select, .controls input {
            padding: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
        }

        .controls select {
            flex: 2;
        }

        .controls input {
            width: 80px;
        }

        .controls button {
            padding: 0.5rem 1rem;
            border: none;
            background: var(--text);
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
            margin-bottom: 1rem;
        }

        th, td {
            padding: 0.75rem;
            border-bottom: 1px solid #eee;
            text-align: left;
        }

        td input {
            width: 60px;
            padding: 0.25rem;
        }

        tr:hover {
            background: #f0f4f8;
        }

        button.remove {
            background: #e63946;
            color: #fff;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
        }

        .summary, .analytics {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: 6px;
            box-shadow: 0 1px 3px var(--shadow);
            margin-bottom: 1rem;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body data-theme="light">
<header>
    <div style="display:flex; align-items:center;"><h1>BuildSync</h1>
        <button class="mode-toggle" id="toggleTheme">☾</button>
    </div>
    <nav>
        <a href="index.html">Dashboard</a>
        <a href="materials.html">Materials</a>
        <a href="bid-builder.html" class="active">Bid Builder</a>
        <a href="settings.html">Settings</a>
    </nav>
</header>
<div class="container">
    <h2>Bid Builder</h2>
    <div class="controls">
        <select id="materialSelect">
            <option value="">-- Select Material --</option>
        </select>
        <input type="number" id="quantityInput" min="1" value="1"/>
        <button id="addBtn">Add to Bid</button>
    </div>
    <table id="bidTable">
        <thead>
        <tr>
            <th>Material</th>
            <th>Unit Price</th>
            <th>Quantity</th>
            <th>Cost</th>
            <th>CO₂</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
    <div class="summary hidden" id="bidSummary">
        <p><strong>Total Cost:</strong> $<span id="totalCost">0.00</span></p>
        <p><strong>Total CO₂:</strong> <span id="totalCarbon">0.00</span> kg</p>
    </div>
    <div class="analytics hidden" id="bidAnalytics">
        <p><strong>Avg Cost per Unit:</strong> $<span id="avgCost">0.00</span></p>
        <p><strong>CO₂ per $:</strong> <span id="carbonPerCost">0.0000</span> kg/$</p>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Theme toggle
        document.getElementById('toggleTheme').onclick = () => {
            const body = document.body;
            const theme = body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            body.setAttribute('data-theme', theme);
            document.getElementById('toggleTheme').textContent = theme === 'light' ? '☾' : '☀';
        };

        // Shared materials data
        const materials = [
            {name: 'Concrete', price: 120, lead: 14, carbon: 0.09},
            {name: 'Rebar', price: 1200, lead: 7, carbon: 1.75},
            {name: 'Insulation', price: 45, lead: 21, carbon: 0.02},
            {name: 'Finishes', price: 200, lead: 10, carbon: 0.15}
        ];

        // Populate material dropdown
        const materialSelect = document.getElementById('materialSelect');
        materials.forEach((m, idx) => {
            const opt = document.createElement('option');
            opt.value = idx;
            opt.textContent = m.name;
            materialSelect.appendChild(opt);
        });

        // Bid items state
        const bidItems = [];
        const bidTable = document.querySelector('#bidTable tbody');
        const qtyInput = document.getElementById('quantityInput');
        const addBtn = document.getElementById('addBtn');
        const summaryEl = document.getElementById('bidSummary');
        const analyticsEl = document.getElementById('bidAnalytics');
        const totalCostEl = document.getElementById('totalCost');
        const totalCarbonEl = document.getElementById('totalCarbon');
        const avgCostEl = document.getElementById('avgCost');
        const carbonPerCostEl = document.getElementById('carbonPerCost');

        // Render bid table and metrics
        function renderBid() {
            bidTable.innerHTML = '';
            bidItems.forEach((item, i) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
            <td>${item.name}</td>
            <td>${item.price}</td>
            <td><input type="number" min="1" value="${item.qty}" onchange="updateQty(${i}, this.value)"></td>
            <td>${(item.price * item.qty).toFixed(2)}</td>
            <td>${(item.carbon * item.qty).toFixed(2)}</td>
            <td><button class="remove" onclick="removeItem(${i})">Remove</button></td>`;
                bidTable.appendChild(tr);
            });
            renderSummary();
        }

        // Update and remove handlers
        window.updateQty = (idx, val) => {
            const q = parseInt(val, 10);
            if (q < 1) return;
            bidItems[idx].qty = q;
            renderBid();
        };
        window.removeItem = (idx) => {
            bidItems.splice(idx, 1);
            renderBid();
        };

        // Summary calculations
        function renderSummary() {
            const totalCost = bidItems.reduce((sum, it) => sum + it.price * it.qty, 0);
            const totalCarbon = bidItems.reduce((sum, it) => sum + it.carbon * it.qty, 0);
            if (totalCost > 0) {
                summaryEl.classList.remove('hidden');
                analyticsEl.classList.remove('hidden');
                totalCostEl.textContent = totalCost.toFixed(2);
                totalCarbonEl.textContent = totalCarbon.toFixed(2);
                const totalQty = bidItems.reduce((sum, it) => sum + it.qty, 0);
                avgCostEl.textContent = (totalCost / totalQty).toFixed(2);
                carbonPerCostEl.textContent = (totalCarbon / totalCost).toFixed(4);
            } else {
                summaryEl.classList.add('hidden');
                analyticsEl.classList.add('hidden');
            }
        }

        // Add to bid
        addBtn.onclick = () => {
            const idx = parseInt(materialSelect.value, 10);
            const qty = parseInt(qtyInput.value, 10);
            if (isNaN(idx) || idx < 0 || isNaN(qty) || qty < 1) return;
            const m = materials[idx];
            bidItems.push({name: m.name, price: m.price, carbon: m.carbon, qty});
            renderBid();
        };

        // Initial render
        renderBid();
    });
</script>
</body>
</html>